---

- hosts: homelab

  vars:
    application: mealie

    docker_network: "{{ networks.pub }}"

  tasks:
    - name: Create config folder
      ansible.builtin.file:
        path: "{{ config_directory }}"
        state: directory
        owner: "{{ common_user }}"
        group: "{{ common_group }}"
        mode: "0771"

    - name: Create container
      ansible.builtin.include_role:
        name: docker_container
      vars:
        image: hkotel/mealie:omni-nightly
        env:
          PUID: "{{ common_user_id | string }}"
          PGID: "{{ common_group_id | string }}"
          TZ: "{{ common_timezone }}"

          ALLOW_SIGNUP: "false"
          RECIPE_PUBLIC: "false"
          RECIPE_DISABLE_COMMENTS: "true"
        volumes:
          - "{{ config_directory }}/data:/app/data"
        traefik:
          - port: 3000
        homepage:
          group: Home
          weight: 200
          description: Recipe management
          widget:
            key: !vault |
              $ANSIBLE_VAULT;1.1;AES256
              32386434316666333261653963386133333938633735646264343733646362653835373662626365
              3566343539653063306464316337303132316539316130310a353533343061323732633136353566
              31326438326535343435313535323434363332396130303166366132323766333737396434356463
              6536333763353962350a303131643938346565353337323266393462346534663238636339343934
              63373065363763663461333065366135343965633630376436613234343332613066653562653132
              39636363656233353161363962393437323962386536363334303933333261373662353866323364
              64643133663466343130626164333537343631376230356265313236396164646238346563616534
              38383665656361616366613138356632303638323633323765613063376336326363643161333863
              61353433353733373964376232376362616136373762373730323463363939643034343337623263
              65633234383632383536363865393639366263656136633366613038353031663436336338613139
              35656664376164323561643265376364626531366633636133336362666437346232643464363030
              30643131623930386637393138623333656133376163316363333265633738356138356561376236
              61393065643539623839376337303438393034373534323362333935333861316537306463646263
              38633263396132636131633333303566353636376662333934623661663039333263326666633533
              63616561616233343864306262613466336637313034636139346233356131363866633231346131
              34353539626234346465363330353463306461333666353962343039633833383934336538346139
              65353830346234336638313338653134366366646466626463646665643066313362
            fields: '["recipes", "categories"]'
