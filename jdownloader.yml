---

- hosts: homelab

  vars:
    application: jdownloader

    docker_network: "{{ networks.pub }}"

  tasks:
    - name: Create config folder
      ansible.builtin.file:
        path: "{{ config_directory }}"
        state: directory
        owner: "{{ common_user }}"
        group: "{{ common_root_group }}"
        mode: "0771"

    - name: Create container
      ansible.builtin.include_role:
        name: docker_container
      vars:
        image: jlesage/jdownloader-2:v23.06.1
        env:
          TZ: "{{ common_timezone }}"
          USER_ID: "{{ common_user_id | string }}"
          GROUP_ID: "{{ common_root_group | string }}"
          DISPLAY_WIDTH: "1920"
          DISPLAY_HEIGHT: "1080"
          KEEP_APP_RUNNING: "1"
          UMASK: "022"
        volumes:
          - "{{ config_directory }}:/config"
          - "{{ common_directory_download }}:/output"
        traefik:
          - port: 5800
            auth: page
        homepage:
          name: jDownloader
          group: Favourites
          weight: 210
          description: "Download manager for hosting sites"
          widget:
            username: !vault |
              $ANSIBLE_VAULT;1.1;AES256
              37623137663361386464393863653335393034616638376338626265313165313539393431326432
              3664643364646661323165396436626361313937643632610a326137323632353832336531336236
              32653463326236396264343966623730656430343331383233663135633337383763633438303266
              3466306438656462630a393761633362396433666263626232333064346338343366363735313037
              61383638316231313665346238326465666661376165353137393065393135616638
            password: !vault |
              $ANSIBLE_VAULT;1.1;AES256
              33646430656233346634303164623765653930313263396337643135633935363732336266653564
              6163626335323264343337613863643038313362343730350a366535353365646437643037336334
              31613333313432623437623764613766343238393465343230326164623336653135333862626666
              3633646434626434620a653737366336356339386539356137633530663838613263333036313835
              32346364333635643434663636643439353665376133373362396663613133323765
            client: "{{ application }}"
