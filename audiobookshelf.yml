---

- hosts: homelab

  vars:
    application: audiobookshelf

    docker_network: "{{ networks.pub }}"

  tasks:
    - name: Create config folder
      ansible.builtin.file:
        path: "{{ config_directory }}"
        state: directory
        owner: "{{ common_user }}"
        group: "{{ common_group }}"
        mode: "0771"

    - name: Create container
      ansible.builtin.include_role:
        name: docker_container
      vars:
        image: ghcr.io/advplyr/audiobookshelf:2.10.1
        volumes:
          - "{{ common_directory_audiobooks }}:/audiobooks"
          # - "{{ common_directory_podcasts }}:/podcasts"
          - "{{ config_directory }}/config:/config"
          - "{{ config_directory }}/metadata:/metadata"
        traefik:
          - port: 80
        homepage:
          group: Favourites
          weight: 600
          description: "Audiobook and podcast server"
          widget:
            fields: '["books"]'
            key: !vault |
              $ANSIBLE_VAULT;1.1;AES256
              35393961383636656230353266656234383665626638396163376635663361316363393032303739
              3463303864303364643033303365306632346432356361610a353661613835316565343031383735
              39353966303930633232346538393465343038346362333335623732616237366532373539656634
              3263666565393761320a303166373232393963373130373133343930633435303061323466303435
              35613338316661646237613961643233626266643764653236646333623031646630363539393364
              62616235666631333736343639663561646261646239383039333930363030643730353238313761
              33316437386665336530376536313235343533346436666431396361323265653364646563333364
              31616532396466616332623363336130613435613362366566316164306536316235326239613934
              33326134346364646663333332313261626632313964346134363164613062313838613964323535
              62383962323263353433636237623762666266663164396562333366396531633333333137656239
              32316138316135383031343961396131636630373537373164313366393966313537323637666231
              66623732333965396465613033323434373332333366343033613764323062646230633730636238
              38633834306435666435643935613836343331383239633530653234333638383264643361353066
              3334363333343663356264336461316162623137633365363734
