---

groups:
  - name: MDADM
    rules:
      -
        alert: MDArrayDegraded
        expr: node_md_degraded == 1
        for: 5m
        annotations:
          summary: MDADM Array Degraded
          description: "{{ $labels.device }} is degraded - one or more disks have failed"
      -
        alert: MDArrayDiskFailed
        expr: node_md_disks{state="failed"} > 0
        for: 1m
        annotations:
          summary: MDADM Disk Failed
          description: "{{ $labels.device }} has {{ $value }} failed disk(s)"
      -
        alert: MDArrayInactive
        expr: node_md_state{state="inactive"} == 1
        for: 1m
        annotations:
          summary: MDADM Array Inactive
          description: "{{ $labels.device }} is inactive - array not available"
      -
        alert: MDArrayResyncing
        expr: node_md_state{state="resync"} == 1
        for: 5m
        annotations:
          summary: MDADM Array Resyncing
          description: "{{ $labels.device }} is resyncing"
      -
        alert: MDArrayRecovering
        expr: node_md_state{state="recovering"} == 1
        for: 1m
        annotations:
          summary: MDADM Array Recovering
          description: "{{ $labels.device }} is recovering from disk failure"
      -
        alert: MDArrayNotFullySynced
        expr: node_md_blocks_synced < node_md_blocks
        for: 1h
        annotations:
          summary: MDADM Array Not Fully Synced
          description: "{{ $labels.device }} sync incomplete for over 1 hour"
