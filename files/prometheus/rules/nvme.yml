---

groups:
  - name: NVMe
    rules:
      -
        alert: NVMeTemperatureWarning
        expr: nvme_temperature_celsius > 70
        for: 10m
        annotations:
          summary: NVMe Temperature Warning
          description: "{{ $labels.device }} is currently {{ $value }}Â°C"
      -
        alert: NVMeCriticalWarning
        expr: nvme_critical_warning != 0
        for: 5m
        annotations:
          summary: NVMe Critical Warning
          description: "{{ $labels.device }} has critical warning flag set ({{ $value }})"
      -
        alert: NVMeMediaErrors
        expr: nvme_media_errors_total > 0
        for: 5m
        annotations:
          summary: NVMe Media Errors
          description: "{{ $labels.device }} has {{ $value }} media errors reading/writing NAND flash"
      -
        alert: NVMeErrorLogEntries
        expr: nvme_num_err_log_entries_total > 0
        for: 5m
        annotations:
          summary: NVMe Error Log Entries
          description: "{{ $labels.device }} has {{ $value }} error log entries"
      -
        alert: NVMeAvailableSpareLow
        expr: nvme_available_spare_ratio < nvme_available_spare_threshold_ratio
        for: 30m
        annotations:
          summary: NVMe Available Spare Below Threshold
          description: "{{ $labels.device }} available spare ({{ $value }}) is below threshold"
      -
        alert: NVMePercentageUsedHigh
        expr: nvme_percentage_used_ratio > 0.8
        for: 1h
        annotations:
          summary: NVMe Percentage Used High
          description: "{{ $labels.device }} is {{ $value | humanizePercentage }} used - nearing end of life"
      -
        alert: NVMeUnsafeShutdownsIncreasing
        expr: increase(nvme_unsafe_shutdowns_total[1h]) > 0
        for: 5m
        annotations:
          summary: NVMe Unsafe Shutdowns Detected
          description: "{{ $labels.device }} has experienced unsafe shutdowns in the last hour"
