---

portainer_name: portainer
portainer_image: portainer/portainer
portainer_config_directory: "{{ common_directory }}/portainer"
portainer_docker_additional_options:
  networks:
    - name: "{{ network.name }}"
      ipv4_address: "{{ network.prefix }}.9"
  command: '--no-auth --no-analytics'
  labels:
    traefik.http.routers.portainer.entrypoints: "web"
    traefik.http.routers.portainer.middlewares: "redirect@file"

    traefik.http.routers.portainer-secure.entrypoints: "web-secure"
    traefik.http.routers.portainer-secure.middlewares: "myAuth@file"
    traefik.http.routers.portainer-secure.tls: "true"
    traefik.http.routers.portainer-secure.tls.certresolver: letsencrypt

    traefik.http.services.portainer.loadbalancer.server.port: "9000"

    com.datadoghq.ad.check_names: '["http_check"]'
    com.datadoghq.ad.init_configs: '[{}]'
    com.datadoghq.ad.instances: '[{"name":"{{ portainer_name }}","url":"https://{{ portainer_name }}.{{ common_tld | string }}","username":"{{ htpasswd.username | string }}","password":"{{ htpasswd.password | string }}"}]'
