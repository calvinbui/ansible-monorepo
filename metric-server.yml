- hosts: homelab

  become: true

  module_defaults:
    k8s:
      kubeconfig: /etc/rancher/k3s/k3s.yaml

  vars:
    metrics_server_version: v0.4.2

  tasks:
    - name: Download metrics-server manifest
      ansible.builtin.get_url:
        url: "https://github.com/kubernetes-sigs/metrics-server/releases/download/{{ metrics_server_version }}/components.yaml"
        dest: "/tmp/metrics-server.yml"
      tags:
        - metrics

    - name: Install metrics-server manifest
      k8s:
        src: "/tmp/metrics-server.yml"
        state: present
      tags:
        - metrics
