---

when:
  - event: push

steps:
  - name: ansible-lint
    image: bash
    commands:
      - export ANSIBLE_CONFIG="$(pwd)/ansible.cfg"
      - .woodpecker/scripts/ansible-lint.sh

  - name: ansible-playbook
    image: bash
    commands:
      - export ANSIBLE_CONFIG="$(pwd)/ansible.cfg"
      - .woodpecker/scripts/ansible-playbook.sh
    when:
      - branch: master

  - name: fail-notification
    image: bash
    commands:
      - mattermost-notify
    when:
      status:
        - failure
